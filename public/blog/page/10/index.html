
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Mere Code</title>
  <meta name="author" content="Jonathan Lange">

  
  <meta name="description" content="In my previous post, I described all of the steps that I and several others took to get my upgrade to zope.testing landed.There has been a problem. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://code.mumak.net/blog/page/10/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Mere Code" type="application/atom+xml">
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="logo">
  	<div id="logoLeft">(</div>
  	<div id="logoText">jml</div>
  	<div id="logoRight">)</div>
  	<div class="clear"></div>
  </div>
  <h1><a href="/">Mere Code</a></h1>
  
    <h2>Diverse Topics of General Interest to the Practicing Programmer</h2>
  
  <div class="clear"></div>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:code.mumak.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About this blog</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/04/plane-has-crashed-into-mountain.html">The plane has crashed into the mountain</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-04-15T00:00:00+01:00" pubdate data-updated="true">2010-04-15 Thursday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
In <a href="http://code.mumak.net/2010/04/all-dude-wanted-was-his-rug-back.html">my previous post</a>, I described all of the steps that I and several others took to get <a href="https://code.edge.launchpad.net/~jml/launchpad/new-zope-testing/+merge/21539">my upgrade</a> to <a href="http://pypi.python.org/pypi/zope.testing">zope.testing</a> landed.<div><br /></div><div>There has been a problem. <a href="https://launchpad.net/subunit">subunit</a> is a dependency of the launchpad-developer-dependencies package, since it&#8217;s only there for running tests.</div><div><br /></div><div>However, subunit is being imported by our core test support package, <code>lp.testing</code>. That package is being imported by the webapp in production. launchpad-developer-dependencies is not installed in production, launchpad-dependencies is instead. Now that I&#8217;ve removed subunit from our sourcecode dependencies, subunit is no longer installed on production.</div><div><br /></div><div>I broke the rollout.</div><div><br /></div><div>The real problem, apparently, is that we are importing lp.testing in production. That problem always existed, but my patch made it known. And now that we know it, we can&#8217;t have unnecessary packages installed on our production systems. Not that installing subunit as a package would be any <i>worse</i> than running a production system that relies on really old non-packaged version, but sometimes you&#8217;ve got to draw a line in the sand. Across this line, you do notâ€”</div><div><br /></div><div>Anyway. Since installing subunit as a package is unacceptable, my patch must be reverted, as well as the <a href="https://code.edge.launchpad.net/~jml/launchpad/subunit-by-default/+merge/18449">ec2 test improvement</a> I did based on it. I can land it again when we have fixed the <q>real</q> problem of production code importing test code.</div><div><br /></div><div><b>Update:</b> Just to be crystal clear, I&#8217;ve talked about this and the previous post with my manager before I posted. Both of us want to understand the underlying problems and solve them. </div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/04/all-dude-wanted-was-his-rug-back.html">All the dude wanted was his rug back</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-04-10T00:00:00+01:00" pubdate data-updated="true">2010-04-10 Saturday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
All I wanted was to get <a href="https://launchpad.net/subunit">subunit</a> output from our test runner. I got it, but at a much higher price than I expected to pay. This is my story.<br /><h2>Quick and dirty, April 2009</h2>It&#8217;s often a good idea to try to get something working as quickly as possible, even if the hack to get it working is a little dirty.<br /><br />For getting subunit output from our test runner, the <i>right</i> thing to do is to change the <code>TestResult</code> object used by the test runner. In Python&#8217;s standard unittest and in most xUnit frameworks, <code>TestResult</code> objects are responsible for reporting results to the user.<br /><br />If <a href="http://pypi.python.org/pypi/zope.testing/">zope.testing</a> were designed more in-line with other Python testing frameworks, this would also have been the quick and easy way to do it.<br /><br />Sadly, zope.testing embeds quite a lot of logic necessary for the execution of tests in its <code>TestResult</code> object, so I can&#8217;t just swap it out for one that implements the standard interface.<br /><br />Instead, I created a <code>MultiTestResult</code> object and added it to <a href="https://launchpad.net/testtools">testtools</a>. It acts like a single test result but dispatches to a bunch of test results.<br /><br />Then I did a quick and dirty thing to silence any output that zope.testing&#8217;s result object might have generated, and used <code>MultiTestResult</code> to glue in a subunit test result. Since zope.testing doesn&#8217;t have a way of plugging in test results, I did some evil monkey patching.<br /><h2>Fix zope.testing, 5th February 2010</h2>Now, what I <i>should</i> have done is fix zope.testing so that it had its own way of generating subunit output cleanly.<br /><br />I didn&#8217;t, because at the time Launchpad was using a very old version of zope.testing. We couldn&#8217;t upgrade because we were using Python 2.4 and new Zope bits needed Python 2.5.<br /><br />However, eventually we got Python 2.5 support, upgraded our Zope Toolkit bits and pieces and started using a newer version of zope.testing. Once that happened, patching zope.testing became feasible, since I&#8217;d actually be able to use the results of my labor.<br /><br />Looking at zope.testing, I would have to either disentangle the layer-running logic from the <code>TestResult</code> code, or I would have to implement my own <q>formatter</q>. Disentangling the layer stuff would be way, way too much work, so I went for the formatter.<br /><br />A zope.testing <code>OutputFormatter</code> is an object that implements a very big, undocumented interface and is responsible for displaying almost all of the output that the Zope testrunner could possibly generate.<br /><br />To implement one, you have to implement twenty-seven methods, most of which lack clear documentation or usage information. There are tests, which is nice, but the tests are big integration tests, rather than unit tests.<br /><br />Anyway, I implemented a subunit output formatter over the course of a few weeks, then submitted it to the Zope community and got it landed. Really, they are wonderful people.<br /><br />Next step, actually using this patch.<br /><h2>Upgrade zope.testing, 13th March 2010</h2>Upgrading zope.testing is easy enough. We use buildout, it&#8217;s a simple question of updating a version number in a configuration file, running a few simple commands, wondering why it doesn&#8217;t work, discovering it&#8217;s a local config issue, repeating two or three times and then you&#8217;re done.<br /><br />Upgrading subunit was really hard. To explain why, I&#8217;ll have to go into some detail about the way Launchpad handles dependencies.<br /><br />We have three different kinds of dependencies:<ol><li>Source code dependencies</li><li>Buildout dependencies</li><li>Package dependencies</li></ol>Each of them is managed differently, and updating each of them has its own complexities. I ended up trying all of them.<br /><h3>Source code</h3>Subunit was already included as a <i>source code</i> dependency. That means that we had a branch with the Launchpad version of subunit, and that we pull from that branch whenever we roll out or update our code. Kind of like svn:externals, but managed with custom scripts.<br /><br />I needed to use a newer subunit than the one we already had in order to get zope.testing subunit output working. To do that, I would have to merge in changes from subunit trunk. Normally, that would be quite easy.<br /><br />However, subunit has since upgraded its Bazaar repository format from something old and crappy into the new, shiny and awesome 2a format. The 2a format is completely incompatible with older formats, and I cannot merge from the new trunk into Launchpad&#8217;s old subunit branch.<br /><br />I have no idea still how to upgrade Launchpad&#8217;s old subunit branch. It&#8217;s a PQM-managed branch and I couldn&#8217;t find documentation. Even if I could upgrade the branch, I&#8217;d have no promise that the tools that our ops guys use to rollout Launchpad would be robust in the face of a Bazaar repository format change. The last thing I want to do is break a rollout because I want to upgrade some developer tools.<br /><h3>Buildout</h3>I then gave up on using source code dependencies and tried buildout, which is our <q>recommended</q> way of handling dependencies.<br /><br />subunit is a tricky thing to handle with buildout. Buildout is at its best when it&#8217;s managing Python packages. subunit is not a Python package. It&#8217;s a multi-language project that builds into some binaries and some libraries, including Python libraries. It uses autotools to do all of this.<br /><br />There are ways to build autotools packages using buildout. You add the egg for the <q><a href="http://pypi.python.org/pypi/zc.recipe.cmmi">cmmi</a></q> recipe to your dependencies and specify a particular build recipe for the autotools package. This kind of worked, but it left me with two problems.<br /><br />The first was that the Python libraries that it generated were buried somewhere deep in the build output, and not included naturally in the Python import paths as happens with a regular setup.py build. Not a big deal, we can glue it together with symlinks.<br /><br />The second is that to build subunit, I actually needed cppunit and check, and maybe some other things. I really, really don&#8217;t want to manually traverse the build dependency chain of subunit and add each of these things as eggs to our buildout <i>just</i> so I can get subunit output from our test suite.<br /><h3>Packages</h3>Which naturally made me think of Debian packages. After all, what better way to manage complex dependencies?<br /><br />Unfortunately, I really don&#8217;t have any idea how to update the Debian packages in <a href="https://edge.launchpad.net/~launchpad/+archive/ppa">our PPA</a>. I asked on #launchpad-dev and quickly got some <a href="https://dev.launchpad.net/LaunchpadPpa">helpful advice</a> about how to do it.<br /><br />There&#8217;s some <code>debian/</code> directory fiddling, changelog updating and so forth. Then I use bzr-builder. Then I submit the branch to l<a href="https://edge.launchpad.net/meta-lp-deps">p:meta-lp-deps</a>, which is where we manage the code for the package, then I build it in the PPA. The PPA build doesn&#8217;t work because I didn&#8217;t sign the code of conduct â€“ easily fixed.<br /><br />I try again and it works and it looks like all is right with the world. Apparently though, I got something wrong. Luckily <a href="https://edge.launchpad.net/~maxb">maxb</a> fixed it for me while I slept so I didn&#8217;t need to do anything about it.<br /><br />Yay! I have now officially updated the version of subunit that we depend on. Now all that&#8217;s left for me to do is propagate that change and then land my branch.<br /><br />To propagate the change, I need to update the EC2 images that we use for running our tests. There&#8217;s a command to do that and a <a href="https://dev.launchpad.net/EC2Test/Image">very helpful wiki page with instructions</a>.<br /><br />I follow the instructions, and it doesn&#8217;t work. The error is weird, and to do with some crazy socket thing. No one has a clue what to do about it, and I&#8217;m actually quite busy doing other things, so I leave it rest for a couple of days.<br /><br />When I come back to try again, I google around for the error and discover that it&#8217;s actually a <a href="https://bugs.edge.launchpad.net/ubuntu/+source/openjdk-6/+bug/542395">bug in openjdk that affected the Lucid beta release</a> and has now been fixed. Hooray, I guess.<br /><br />I update my Lucid install and get ec2 to build the new image for testing. Once that&#8217;s done, I need to get our ops guys to update the <i>completely different </i>set of images that we use on our buildbot.<br /><br />I send off a request, and there&#8217;s a bit of back-and-forth. Apparently we use one archive for development, which I&#8217;ve updated, and a completely different archive for production rollouts, which I am not allowed to update. After ten working days, it all gets sorted out, and now I am able to land my branch.<br /><h2>Landing the branch, 10th April 2010</h2>At last, I&#8217;m ready to land my branch.<br /><br />It doesn&#8217;t work. Of course.<br /><br />I could have sworn that I ran the full test suite with it, both with subunit output and with the default, but it seems to be broken in two ways.<br /><br />The first is that the subunit output support in zope.testing is broken. I made the <code>error</code> method raise <code>NotImplementedError</code>. This means that if ever a layer fails to start up properly, the test runner dies with an unhelpful error that masks the layer&#8217;s own error. Suck.<br /><br />The right way to fix it is to add a new API to the formatter to specifically handle layer set-up errors. I take the quick-and-dirty approach of just printing out whatever <code>error</code> gets. Patch is sent off to zope-dev mailing list.<br /><br />The second is that new zope.testing has deprecated its <code>doctest</code> module, and emits deprecation warnings all over the place. We have tests that fail if warnings are emitted â€“ sixteen, to be precise â€“ so I can&#8217;t upgrade until I somehow stop the warnings.<br /><br />They are generated by zope.app.testing.functional in the Librarian start-up. Why on earth the Librarian needs <a href="http://pypi.python.org/pypi/zope.app.testing">zope.app.testing</a> is beyond me. I fetch zope.app.testing, work around <a href="https://bugs.edge.launchpad.net/ubuntu/+source/distribute/+bug/490731">a bug in python-setuptools</a> to get it building, patch it and submit the patch to the zope list.<br /><br />If I wanted to, I could make two new eggs now for the two patched projects and then just land the branch. I don&#8217;t think I want to, since the patches are so small I&#8217;m confident I can get them landed and maybe even persuade someone to do releases.<br /><br />The fix to zope.app.testing lands without a hitch, and yet another kind person from the Zope community does a release and even do what they can to get the other patch landed.<div><br /></div><div>However, it turns out that between zope.app.testing 3.7.3 and the new 3.7.5 that I need, zope.app.testing has started to depend on <a href="http://pypi.python.org/pypi/zope.component">zope.component</a> 3.8 or better. zope.component has made some changes that break API compatibility with a stack of other Zope bits, including <a href="http://pypi.python.org/pypi/zope.sendmail">zope.sendmail</a> and <a href="http://pypi.python.org/pypi/zope.app.component">zope.app.component</a>. zope.sendmail has been updated, but zope.app.component has not. I can&#8217;t find the code to patch it either.</div><div><br /></div><div>Luckily, Launchpad doesn&#8217;t really use the broken bits of zope.app.component, so it&#8217;s easy enough to <a href="http://bazaar.launchpad.net/~jml/launchpad/new-zope-testing/revision/10456">work around the problem</a> there, and bump zope.sendmail&#8217;s version in our buildout configuration.</div><div><br /></div><div>Then the fix for zope.testing lands, and <a href="https://launchpad.net/~sidnei">Sidnei</a> is again kind enough to release. I bump our versions.cfg, and land the branch.</div><div><br /></div><div>It is finished.</div><div><h2>Thoughts</h2>It should be obvious by now that I think the whole process has been unreasonably complicated and taken far too long.<br /><br />Perhaps I chose a task that was fundamentally difficult. Perhaps it was a one-off <q>perfect storm</q> of confounding factors. Perhaps there are deep, serious problems in the way we do things. Perhaps I&#8217;m just not very good.<br /><br />I certainly made some mistakes. For a start, I shouldn&#8217;t have been so afraid of breaking the edge rollout. We take measures like daily edge rollouts precisely so that we can catch our mistakes, which should embolden us to try things.<br /><br />I also should have done more testing between the time I asked for the image updates and the time I landed the branch.<br /></div><div><br /></div><div>I kind of like the way that Zope has been split out into a million little projects. I think it made it easier for me to come along with my small, opportunistic patches, and made it easier for others to review and land them. It also makes it easier for stupid backwards compatibility mistakes (since you can&#8217;t just grep a tree). I somehow think that if <a href="http://twistedmatrix.com/">Twisted</a> broke itself up, they&#8217;d find a way to deal systemically with backwards compatibility changes, if only by blocking them in review.</div><div><br /></div><div>Also, it would be pretty much impossible to use Zope at all without <a href="http://pypi.python.org/">PyPI</a>.</div><div><br /></div><div>I would love to know what you all think of this, and whether you have any thoughts on how we can make hacking on Launchpad easier.</div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>jml<span class='comment-date'> on 2010-04-15 13:24</span></div>
<div class='content'>
Yes. :)</div>
</div>
<div class='comment'>
<div class='author'>bialix<span class='comment-date'> on 2010-04-15 12:44</span></div>
<div class='content'>
Does the title has inspired by &quot;Big Lebowski&quot; movie?</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/launchpad-improving-gnomes-bugzilla.html">Launchpad improving GNOME&#8217;s Bugzilla</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-31T00:00:00+01:00" pubdate data-updated="true">2010-03-31 Wednesday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Just read a very cool article about <a href="http://www.gnomejournal.org/article/96/canonical-upgrading-gnome-bugzilla-and-commercial-sponsorship">Canonical funding improvements to GNOME Bugzilla</a>, making it easier for Ubuntu and GNOME to share bugs.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/new-sexy.html">New sexy</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-22T00:00:00+00:00" pubdate data-updated="true">2010-03-22 Monday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
My new shiny iMac 27&#8221; arrived today. It is very beautiful, although the screen is dauntingly large. When the <a href="http://kanexlive.com/products/item-id-3662.html">Kanex XD thingies</a> come out, I&#8217;ll be able to plug my XBox into it too.<div><br /></div><div>It&#8217;s the first time in a long time I&#8217;ve done a fresh install of a non-Ubuntu computer though. Some things, however, remain the same.</div><div><ol><li>Download decent browser (Firefox or Chrome)</li><li>Download IRC client (for OS X, Colloquy)</li><li>Generate SSH key</li><li>Upload SSH key to server, register it on <a href="https://launchpad.net/~jml">Launchpad</a></li><li>Change the default Terminal settings to light grey text on a translucent black background</li><li>Get Emacs</li></ol><div>Oh, and to forestall questions, I&#8217;m not going to dual boot right now but I plan to eventually.</div></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>jml<span class='comment-date'> on 2010-03-24 12:00</span></div>
<div class='content'>
I use Ubuntu on my primary machine and fail to see how using another OS on my secondary machine is a problem.</div>
</div>
<div class='comment'>
<div class='author'>Daeng Bo<span class='comment-date'> on 2010-03-24 05:06</span></div>
<div class='content'>
I saw this post on Canonical Voices, and I just have two words: &quot;dog food.&quot;</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/cowtasks.html">Cowtasks</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-21T00:00:00+00:00" pubdate data-updated="true">2010-03-21 Sunday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
If you&#8217;ve got a Palm Pre and you want to be able to synchronize tasks from the Pre to <a href="http://rememberthemilk.com">Remember the Milk</a>, then please start hacking on <a href="http://launchpad.net/cowtasks">CowTasks</a>.<div><br /></div><div>The original author has given up development, open sourced it and I&#8217;ve put it on Launchpad. I don&#8217;t have the time to maintain it either, but I&#8217;d love it if someone did.</div><div><br /></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Dave H.<span class='comment-date'> on 2010-06-10 19:58</span></div>
<div class='content'>
Thanks for sharing - I&#39;ve been looking for a good tasks app with sync!</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/visualizing-yak-shaving.html">Visualizing yak-shaving</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-15T00:00:00+00:00" pubdate data-updated="true">2010-03-15 Monday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Over the weekend I read <a href="http://carymillsap.blogspot.com/">Cary Millsap</a>&#8217;s excellent paper <a href="http://method-r.com/downloads/doc_details/44-thinking-clearly-about-performance"><i>Thinking Clearly About Performance</i></a>. In it, he hijacks the <a href="http://www.agilemodeling.com/artifacts/sequenceDiagram.htm">UML Sequence Diagram</a> format by drawing the vertical axis to scale. The bigger the gap between lines, the more time was taken performing that interaction. Suddenly, the sequence diagram can give you a clear picture of where time is being spent.<div><br /></div><div>Wouldn&#8217;t this be a useful diagram to draw instead of <a href="http://en.wikipedia.org/wiki/Value_stream_mapping">value-stream maps</a>? You would lose the easy distinction between &#8220;value generating&#8221; and &#8220;waste&#8221; steps, but I think you&#8217;d gain a deeper understanding of hand-offs and of system complexity. Drawing it to scale would give a helpful picture of where time is being spent, and where response time can be improved. </div><div><br /></div><div>More generally, Lean folk should probably read Millsap&#8217;s paper and think hard about what it means for software engineering process.</div><div><br /></div><div>Also, I reckon drawing up a quick sequence diagram would be a great way of seeing how deep one is in <a href="http://en.wiktionary.org/wiki/yak_shaving">yak-shaving</a>. Each time you go one layer deeper, add a new column and draw a new arrow and make a note of when &amp; why.</div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>Marlin Forbes<span class='comment-date'> on 2010-10-26 09:36</span></div>
<div class='content'>
In my experience, it would be realized as a stack with the most recent problem to solve topmost.</div>
</div>
<div class='comment'>
<div class='author'>Cory<span class='comment-date'> on 2010-03-15 16:00</span></div>
<div class='content'>
&gt; I reckon drawing up a quick sequence diagram would be a great way of seeing how deep one is in yak-shaving. Each time you go one layer deeper, add a new column and draw a new arrow and make a note of when &amp; why.<br /><br />I love this idea.  I&#39;m going to try it out.  I&#39;m deep enough in my current projects (both at work and at home) that this will be a non-trivial diagram.<br /><br />If it provides any useful information, I may share this with my team as well.  Thanks!</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/launchpadlib-gotchas.html">launchpadlib gotchas</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-12T00:00:00+00:00" pubdate data-updated="true">2010-03-12 Friday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
I&#8217;ve shown you how to <a href="http://code.mumak.net/2010/03/get-started-with-launchpadlib.html">get started with launchpadlib</a> and have shown a <a href="http://code.mumak.net/2010/03/launchpadlib-powerup.html">slightly more complex launchpadlib script</a>.<br /><br />Before I cry <q>The power is yours!</q> and return to my home within the earth, I&#8217;m going to warn you about the things that can trip you up when using launchpadlib.<br /><h3>Bugs</h3><a href="https://bugs.launchpad.net/launchpadlib/">launchpadlib</a> has bugs. There are also bugs in <a href="https://bugs.launchpad.net/lazr.restful">lazr.restful</a> and <a href="https://bugs.launchpad.net/lazr.restfulclient">lazr.restfulclient</a> â€“ two libraries that are core to launchpadlib&#8217;s behaviour.<div><br /></div><div>Welcome to software engineering.<br /><h3>Documentation</h3>It&#8217;s <a href="https://help.launchpad.net/API">on the wiki</a>, and it&#8217;s good, but it could always be better. There&#8217;s a page of <a href="https://help.launchpad.net/API/Examples"> as well as a </a><a href="https://help.launchpad.net/API/launchpadlib">guide on launchpadlib</a>.<br /><br />The <a href="https://launchpad.net/+apidoc/">reference documentation</a> isn&#8217;t written for Python programmers. It&#8217;s written for REST programmers. Actually, it&#8217;s not written at all but rather auto-generated from our source code. Sometimes this can be  confusing, and I frequently find myself consulting the <a href="http://bazaar.launchpad.net/~launchpad-pqm/launchpad/db-devel/files">Launchpad source code</a> to get things done with the API.<br /><h3>Error messages</h3>I&#8217;m told this has got better with recent releases, but often when you get an error in launchpadlib, it looks like an HTTP error and you have very little help on how to  debug it. Unfortunately, I don&#8217;t have an example ready.<br /><br />If you come across an error like this, file a bug and head straight to #launchpad-dev on freenode to get help.<br /><h3>Potato programming</h3>It&#8217;s really easy to write code with launchpadlib that does this:<pre>  for thing in bunch_of_things:<br />    thing.do_something_on_launchpad()<br /></pre>Code like this is really slow. It will do one round-trip per <q>thing</q>, which can be quite expensive. Twisted folks sometimes call this <q><a href="http://divmod.org/trac/wiki/PotatoProgramming">potato programming</a></q>.<br /><h3>Exposure</h3>Not all of the code within Launchpad is exposed through the API. We have to expose things manually and we haven&#8217;t done it all yet. Sorry.<br /><br />If you come across something that you want, then please <a href="https://bugs.launchpad.net/launchpad/+filebug">file a bug</a> and tag it with <q>api</q>.<br /><br />In general, exposing something of the API is really easy or almost impossible. If the thing you want falls into the first category, you can probably patch Launchpad yourself.<br /><h3>Testing</h3>Testing launchpadlib apps is hard. You do not want your unit tests to run against launchpad.net and running your own instance of Launchpad simply to run unit tests is masochistically stupid.<br /><br />I think the situation here has improved recently too, but I haven&#8217;t heard much about it or explored it myself.<br /><h3>Conclusion</h3>There you have it, all of the gotchas for writing code with launchpadlib. As you can see, it&#8217;s not really any worse than writing for any Python library â€“ I&#8217;m just being up-front with you because I like you.<br /><br />If any of these gotchas no longer apply, please correct me and I will shout your good news from the rooftops.<br /><br />Until then, happy hacking.<br /></div></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>mbp<span class='comment-date'> on 2010-03-17 23:39</span></div>
<div class='content'>
What a nice post.<br /><br />What should one do to avoid potato programming?<br /><br />The best option for testing seems to be to run your app against staging, which is a real Launchpad instance with a separate expendable database where you can change whatever you like.<br /><br />It&#39;s worth knowing about  James&#39;s tip in :<br /><br />httplib2.debuglevel = 1<br /><br />which will show you a bit of what&#39;s happening on the network.</div>
</div>
</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/have-you-tried-lptools.html">Have you tried lptools?</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-11T00:00:00+00:00" pubdate data-updated="true">2010-03-11 Thursday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
Have you tried <a href="https://edge.launchpad.net/lptools">lptools</a>?<br /><br />It&#8217;s not at all officially associated with the Launchpad project, of course, but it&#8217;s got a few nice things that you might want to look at, including:<div><ul><li>a milestone manipulator</li><li>a code review notifier, and</li><li>a milestone to iCal exporter</li></ul>One of these days, I&#8217;d like for there to be an official, awesome Launchpad command-line client. As it is, I&#8217;m happy with the world of people making extensions to meet their needs.<br /><br />For other extensions, check out the <a href="https://launchpad.net/lpx">lpx project</a> or our <a href="http://help.launchpad.net/Clients">list of clients</a>.<br /></div></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/launchpadlib-powerup.html">launchpadlib powerup</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-10T00:00:00+00:00" pubdate data-updated="true">2010-03-10 Wednesday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
In my last post, I <a href="http://code.mumak.net/2010/03/get-started-with-launchpadlib.html">introduced launchpadlib</a> and demonstrated a very simple script that uses it. In this post, I&#8217;d like to build on that a bit and show you how to do something actually interesting.<br /><br />In particular, I want to show you how to search for bugs, teach you a bit about Launchpad&#8217;s internal data model and help you help yourself when it comes to figuring out Launchpad APIs.<br /><br />The script at <a href="https://code.edge.launchpad.net/~jml/+junk/bugstats">lp:~jml/+junk/bugstats</a> is designed to tell you how good you are at filing bugs. It uses a very simple metric: out of the bugs that you&#8217;ve filed, how many actually have been fixed.<pre>$ ./bugstats.py ubuntu jml<br />jml is 22.22% successful on bugs in Ubuntu<br />$ ./bugstats.py launchpad-code jml<br />jml is 47.63% successful on bugs in Launchpad Code</pre>To do that, we need to:<ol><li>get the &#8220;project&#8221; and person referred to on the command line</li><li>search for all fixed bugs filed by that person</li><li>search for all bugs in total by that same person</li><li>count them both</li><li>divide them</li><li>print them!</li></ol>I say &#8220;project&#8221;, but I really should say &#8220;pillar&#8221;, which is the Launchpad technical term for a project (e.g. &#8220;bzr&#8221;), distribution (e.g. &#8220;ubuntu&#8221;) or project group (e.g. &#8220;gnome&#8221;). A pillar is anything in first part of Launchpad URL that isn&#8217;t a person.<br /><br />We get the pillar and person like this:<pre>   pillar = launchpad.projects[pillar_name]<br />  reporter = launchpad.people[reporter_name]</pre>Pretty easy, huh? Now, how do we search for bug tasks?<br /><br />The first port of call is to go to the <a href="https://launchpad.net/+apidoc">Launchpad API reference</a> page. I&#8217;m going to look for the string &#8216;reporter&#8217;, since that&#8217;s the one thing I definitely know I want to find.<br /><br />Eventually, I found the <code>searchTasks</code> method (named operation) that&#8217;s on pillars and takes a <code>bug_reporter</code> parameter and a <code>status</code> parameter. It returns a collection of <code>bug_tasks</code>, which are the objects that represent the rows in the table you see at the top of a bug page.<br /><br />I can find the bugtasks for the bugs I&#8217;ve reported that have been fixed by doing:<pre>   fixed_bugtasks = pillar.searchTasks(<br />      bug_reporter=reporter, status=['Fix Released'])</pre>It took me a while to figure out exactly how to spell &#8220;Fix Released&#8221;. I ended up using trial and error.<br /><br />Similarly, I can all the bugtasks for bugs I&#8217;ve filed by doing:<pre>   total_bugtasks = pillar.searchTasks(<br />      bug_reporter=reporter,<br />      status=[<br />          "New",<br />          "Incomplete",<br />          "Invalid",<br />          "Won't Fix",<br />          "Confirmed",<br />          "Triaged",<br />          "In Progress",<br />          "Fix Committed",<br />          'Fix Released'])</pre>I cheated a bit for that one and looked at the launchpad code to get a list of all bug statusus. The default for <code>searchTasks</code> is to only return open bugs.<br /><br />Once we&#8217;ve got the collections of bug tasks, we need to get their counts. In an ideal world, it would be <code>len(total_bugtasks)</code>, but sadly <a href="https://bugs.edge.launchpad.net/launchpadlib/+bug/274074">bug 274074</a> means that <code>len</code> is really, really slow here.<br /><br />Instead, I wrote this helper function:<pre>def length(collection):<br />  # XXX: Workaround bug 274074. Thanks wgrant.<br />  return int(collection._wadl_resource.representation['total_size'])</pre>With that, I can calculate &amp; print my success rate at filing bugs:<pre>   percentage = 100.0 * length(fixed_bugtasks) / length(total_bugtasks)<br />  print "%s is %.2f%% successful on bugs in %s" % (<br />      reporter.display_name, percentage, pillar.display_name)</pre>Next up on the API, I&#8217;ll talk about some of the gotchas and what you can do about them.</div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <!-- Now we're back to normal posts. Note the links used under href in both headers.-->
        <h1 class="entry-title"><a href="/2010/03/get-started-with-launchpadlib.html">Get started with launchpadlib</a></h1>
      
    
    
      <p class="meta">
        








  


<time datetime="2010-03-09T00:00:00+00:00" pubdate data-updated="true">2010-03-09 Tuesday</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class='post'>
In my spare time, I sometimes talk to people about how they can get started with launchpadlib hacking.<br /><br />launchpadlib is the Python client-side library that talks to Launchpad&#8217;s own <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST</a> API. It turns out that customize scripted control of a <a href="https://launchpad.net/">bug-tracker-code-hosting-translation-distribution-building-cross-project-collaboration thing</a> is actually quite handy.<br /><br />If you want to get started hacking with launchpadlib, and you have Ubuntu, then install &#8216;python-launchpadlib&#8217; now. I&#8217;m pretty sure you can also get it from PyPI.<br /><br />You can check that it works by running:<span class="Apple-style-span"   style="font-family:monospace;font-size:100%;"><span class="Apple-style-span"  style=" white-space: pre;font-size:13px;"><span class="Apple-style-span"   style="font-family:Georgia, serif;font-size:130%;"><span class="Apple-style-span"  style=" white-space: normal;font-size:14px;"><br /></span></span></span></span><pre>$ python<br />>>> import launchpadlib<br />>>> launchpadlib.__version__<br />'1.5.1'<br /></pre><br />I&#8217;ll be assuming you&#8217;re running 1.5.1 or later.<br /><br />I&#8217;ve written a very simple launchpadlib application that you can get with &#8216;bzr branch lp:~jml/+junk/bugstats&#8217;. Each revision shows a meaningful launchpadlib script. You can get at the old revisions with &#8216;bzr revert -r1&#8217; or &#8216;bzr revert -r2&#8217; or &#8216;-r3&#8217;.<br /><br />Here&#8217;s what the simplest launchpadlib script that I could think of looks like:<br /><pre>import os<br />import sys<br />from launchpadlib.launchpad import Launchpad, STAGING_SERVICE_ROOT<br /><br />APP_NAME = 'jml-bug-stats'<br />CACHE_DIR = os.path.expanduser('~/.launchpadlib/cache')<br />SERVICE_ROOT = STAGING_SERVICE_ROOT<br /><br />launchpad = Launchpad.login_with(APP_NAME, SERVICE_ROOT, CACHE_DIR)<br />print launchpad.bugs[1].title<br /></pre>(Adapted from r2 of the above branch).<br /><br />A few points.<br /><br /><ul><li>We use <code>STAGING_SERVICE_ROOT</code>, which means that we&#8217;re pointing<br />at <a href="https://staging.launchpad.net/">Launchpad&#8217;s staging service</a>,<br />just in case we screw up any data.</li><br /><li>We give the application a name, when you run the application, launchpadlib<br />opens up a browser window letting <i>you</i> decide how far the application<br />can act on <i>your</i> behalf.</li><li>We provide a cache directory. Credentials, among other things, get stored<br />here.<br /></li><li>We then login and get an object that represents a Launchpad instance</li><li>Once we&#8217;ve got it, we look at the collection of bugs, get Bug #1 and then<br />print the title</li></ul>Very simple. To learn how to write this application, I looked at the main <a href="https://help.launchpad.net/API">Launchpad API help</a> page, the<br /><a href="https://help.launchpad.net/API/Examples">examples</a> page and the <a href="https://staging.launchpad.net/+apidoc">reference documentation</a>. You&#8217;ll notice that I had to translate the reference documentation from REST-speak into Python-speak.<br /><br />Already you have enough to go exploring with the Launchpad API and think of cool things to do. A bunch of people are already doing <a href="https://help.launchpad.net/Clients">cool stuff</a> and there are many <a href="https://help.launchpad.net/API/Uses">projects that use launchpadlib</a>.<br /><br />Next up, I hope to show you some more complex things you can do with the API.</div>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/11/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/9/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/04/deliberately-being-naughty.html">Deliberately being naughty</a>
      </li>
    
      <li class="post">
        <a href="/2013/02/testtools-moved-to-github.html">testtools moved to Github</a>
      </li>
    
      <li class="post">
        <a href="/2013/02/are-single-variable-names-evil.html">Are single letter variable names evil?</a>
      </li>
    
      <li class="post">
        <a href="/2012/12/getting-set-up-with-twisted-development.html">Getting set up with Twisted development</a>
      </li>
    
      <li class="post">
        <a href="/2012/11/whats-wrong-with-orms.html">What&#8217;s wrong with ORMs</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/jml">@jml</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jml',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/jonathan.lange?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Jonathan Lange -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
