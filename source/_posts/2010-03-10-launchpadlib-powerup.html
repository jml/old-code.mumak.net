---
layout: post
title: "launchpadlib powerup"
date: 2010-03-10
comments: false
---

<div class='post'>
In my last post, I <a href="http://code.mumak.net/2010/03/get-started-with-launchpadlib.html">introduced launchpadlib</a> and demonstrated a very simple script that uses it. In this post, I'd like to build on that a bit and show you how to do something actually interesting.<br /><br />In particular, I want to show you how to search for bugs, teach you a bit about Launchpad's internal data model and help you help yourself when it comes to figuring out Launchpad APIs.<br /><br />The script at <a href="https://code.edge.launchpad.net/~jml/+junk/bugstats">lp:~jml/+junk/bugstats</a> is designed to tell you how good you are at filing bugs. It uses a very simple metric: out of the bugs that you've filed, how many actually have been fixed.<pre>$ ./bugstats.py ubuntu jml<br />jml is 22.22% successful on bugs in Ubuntu<br />$ ./bugstats.py launchpad-code jml<br />jml is 47.63% successful on bugs in Launchpad Code</pre>To do that, we need to:<ol><li>get the "project" and person referred to on the command line</li><li>search for all fixed bugs filed by that person</li><li>search for all bugs in total by that same person</li><li>count them both</li><li>divide them</li><li>print them!</li></ol>I say "project", but I really should say "pillar", which is the Launchpad technical term for a project (e.g. "bzr"), distribution (e.g. "ubuntu") or project group (e.g. "gnome"). A pillar is anything in first part of Launchpad URL that isn't a person.<br /><br />We get the pillar and person like this:<pre>   pillar = launchpad.projects[pillar_name]<br />  reporter = launchpad.people[reporter_name]</pre>Pretty easy, huh? Now, how do we search for bug tasks?<br /><br />The first port of call is to go to the <a href="https://launchpad.net/+apidoc">Launchpad API reference</a> page. I'm going to look for the string 'reporter', since that's the one thing I definitely know I want to find.<br /><br />Eventually, I found the <code>searchTasks</code> method (named operation) that's on pillars and takes a <code>bug_reporter</code> parameter and a <code>status</code> parameter. It returns a collection of <code>bug_tasks</code>, which are the objects that represent the rows in the table you see at the top of a bug page.<br /><br />I can find the bugtasks for the bugs I've reported that have been fixed by doing:<pre>   fixed_bugtasks = pillar.searchTasks(<br />      bug_reporter=reporter, status=['Fix Released'])</pre>It took me a while to figure out exactly how to spell "Fix Released". I ended up using trial and error.<br /><br />Similarly, I can all the bugtasks for bugs I've filed by doing:<pre>   total_bugtasks = pillar.searchTasks(<br />      bug_reporter=reporter,<br />      status=[<br />          "New",<br />          "Incomplete",<br />          "Invalid",<br />          "Won't Fix",<br />          "Confirmed",<br />          "Triaged",<br />          "In Progress",<br />          "Fix Committed",<br />          'Fix Released'])</pre>I cheated a bit for that one and looked at the launchpad code to get a list of all bug statusus. The default for <code>searchTasks</code> is to only return open bugs.<br /><br />Once we've got the collections of bug tasks, we need to get their counts. In an ideal world, it would be <code>len(total_bugtasks)</code>, but sadly <a href="https://bugs.edge.launchpad.net/launchpadlib/+bug/274074">bug 274074</a> means that <code>len</code> is really, really slow here.<br /><br />Instead, I wrote this helper function:<pre>def length(collection):<br />  # XXX: Workaround bug 274074. Thanks wgrant.<br />  return int(collection._wadl_resource.representation['total_size'])</pre>With that, I can calculate &amp; print my success rate at filing bugs:<pre>   percentage = 100.0 * length(fixed_bugtasks) / length(total_bugtasks)<br />  print "%s is %.2f%% successful on bugs in %s" % (<br />      reporter.display_name, percentage, pillar.display_name)</pre>Next up on the API, I'll talk about some of the gotchas and what you can do about them.</div>
